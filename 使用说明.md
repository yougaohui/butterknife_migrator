# ButterKnife 自动迁移工具使用说明

## 📖 简介

这是一个自动化的 ButterKnife 迁移工具，可以将 Android 项目中的 ButterKnife 注解自动转换为标准的 `findViewById` 和 `setOnClickListener` 代码。

## ✨ 主要功能

- 🔍 **自动扫描**: 自动检测项目目录结构，扫描 Java 文件
- 🎯 **智能识别**: 自动识别 `@BindView` 和 `@OnClick` 注解
- 🔧 **代码转换**: 将注解转换为标准 Android 代码
- 🏗️ **架构支持**: 支持 `NewBaseActivity` 和 `NewBaseFragment` 定制化处理
- 📝 **现代语法**: 生成 Lambda 表达式，移除类型转换
- 📋 **详细报告**: 生成迁移报告和日志

## 🚀 快速开始

### 方法一：直接运行（推荐）

1. **下载工具**
   - 将整个工具文件夹复制到你的 Android 项目根目录

2. **运行迁移**
   - **Windows**: 双击 `run_migration.bat`
   - **Linux/Mac**: 运行 `./run_migration.sh`

3. **查看结果**
   - 工具会自动扫描并迁移所有包含 ButterKnife 注解的文件
   - 查看生成的 `butterknife_migration_report.json` 报告

### 方法二：Python 运行

```bash
# 确保已安装 Python 3.7+
python auto_migrate.py
```

## 📁 项目结构

```
your-android-project/
├── app/
│   └── src/main/java/
├── butterknife_migrator/          # 迁移工具
│   ├── auto_migrate.py            # 自动迁移主程序
│   ├── run_migration.bat          # Windows 启动脚本
│   ├── run_migration.sh           # Linux/Mac 启动脚本
│   ├── config.py                  # 配置文件
│   ├── scanner/                   # 文件扫描模块
│   ├── butterknife_parser_module/ # 注解解析模块
│   ├── transformer/               # 代码转换模块
│   ├── injector/                  # 代码注入模块
│   ├── writer/                    # 文件写入模块
│   └── utils/                     # 工具模块
└── butterknife_migration_report.json  # 迁移报告
```

## 🔧 支持的转换

### @BindView 注解转换

**转换前:**
```java
@BindView(R.id.title_text)
TextView titleText;

@BindView(R.id.submit_button)
Button submitButton;
```

**转换后:**
```java
TextView titleText;
Button submitButton;

@Override
protected void initViews() {
    titleText = findViewById(R.id.title_text);
    submitButton = findViewById(R.id.submit_button);
}
```

### @OnClick 注解转换

**转换前:**
```java
@OnClick({R.id.submit_button, R.id.cancel_button})
public void onButtonClick(View view) {
    // 处理点击事件
}

@OnClick(R.id.record_button)
public void onRecordClick() {
    // 处理录制
}
```

**转换后:**
```java
public void onButtonClick(View view) {
    // 处理点击事件
}

public void onRecordClick() {
    // 处理录制
}

@Override
public void initListener() {
    submitButton.setOnClickListener(v -> onButtonClick(v));
    cancelButton.setOnClickListener(v -> onButtonClick(v));
    recordButton.setOnClickListener(v -> onRecordClick());
}
```

## 🏗️ 特殊架构支持

### NewBaseActivity 支持

对于继承 `NewBaseActivity` 的类，工具会自动：
- 创建 `initViews()` 方法初始化 View
- 创建 `initListener()` 方法初始化监听器
- 保持 `getLayoutId()` 方法不变

### NewBaseFragment 支持

对于继承 `NewBaseFragment` 的类，采用相同的处理方式。

## ⚙️ 配置选项

工具会自动检测项目结构，但也可以通过修改 `config.py` 进行自定义：

```python
# 扫描目录
SCAN_DIRECTORIES = [
    "app/src/main/java",
    "src/main/java",
    "java"
]

# 排除目录
EXCLUDE_DIRECTORIES = [
    "build",
    ".gradle",
    ".idea"
]

# 是否启用备份
BACKUP_ENABLED = True
```

## 📊 迁移报告

迁移完成后会生成 `butterknife_migration_report.json` 报告：

```json
{
  "total_files": 25,
  "butterknife_files": 8,
  "migrated_files": 8,
  "success_rate": "100.0%",
  "project_path": "/path/to/your/project",
  "scan_directories": ["app/src/main/java"]
}
```

## 🔍 自动检测功能

工具会自动检测：
- ✅ Android 项目类型
- ✅ 源码目录结构
- ✅ ButterKnife 注解
- ✅ 继承关系（NewBaseActivity/NewBaseFragment）
- ✅ 方法参数类型

## ⚠️ 注意事项

1. **备份重要**: 工具会自动创建备份文件（.bak），但建议在版本控制系统中提交代码
2. **检查结果**: 迁移后请检查生成的代码，确保符合项目规范
3. **测试验证**: 建议在测试环境中先运行，验证功能正常
4. **依赖清理**: 迁移完成后记得移除 ButterKnife 相关依赖

## 🐛 故障排除

### 常见问题

1. **Python 未安装**
   - 下载安装 Python 3.7+: https://www.python.org/downloads/

2. **权限问题**
   - Linux/Mac: `chmod +x run_migration.sh`

3. **编码问题**
   - 确保项目文件使用 UTF-8 编码

4. **扫描不到文件**
   - 检查项目目录结构
   - 修改 `config.py` 中的扫描目录

### 日志文件

查看 `butterknife_migration.log` 获取详细错误信息。

## 📞 技术支持

如有问题，请检查：
1. 日志文件 `butterknife_migration.log`
2. 迁移报告 `butterknife_migration_report.json`
3. 备份文件（.bak 扩展名）

## 🎯 最佳实践

1. **版本控制**: 在迁移前提交代码到 Git
2. **分支操作**: 在独立分支中进行迁移
3. **逐步迁移**: 可以分批迁移，避免一次性处理过多文件
4. **代码审查**: 迁移后进行代码审查，确保质量
5. **测试验证**: 运行单元测试和 UI 测试，确保功能正常
